<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>CV Multilingue - Katell GOUZERH</title>
        
        <!-- Liens vers autres versions linguistiques pour le SEO -->
        <link rel="alternate" hreflang="fr-FR" href="cv_fr.html">
        <link rel="alternate" hreflang="en-GB" href="cv_en.html">
        <link rel="alternate" hreflang="zh-CN" href="cv_zh.html">
        <link rel="alternate" hreflang="x-default" href="cv_fr.html">
        
        <!-- CSS centralis√© -->
        <link rel="stylesheet" href="cv.css">
        
        <!-- M√©tadonn√©es pour le SEO -->
        <meta name="description" content="CV multilingue de Katell GOUZERH - √âtudiante ing√©nieur informatique √† la recherche d'une alternance">
        <meta name="keywords" content="CV, portfolio, ing√©nieur informatique, alternance, Katell GOUZERH">
        <meta name="author" content="Katell GOUZERH">
        
        <!-- Open Graph -->
        <meta property="og:title" content="CV Multilingue - Katell GOUZERH">
        <meta property="og:description" content="√âtudiante ing√©nieur informatique √† la recherche d'une alternance">
        <meta property="og:type" content="website">
    </head>
    <body>
        <div class="loading">
            <h1>Chargement du CV multilingue...</h1>
            <p>Le contenu se charge depuis les donn√©es XML avec transformation XSLT.</p>
            <p><small>D√©termination de la langue en cours...</small></p>
            
            <!-- Boutons de langue de secours -->
            <div class="emergency-lang-selector" id="emergency-selector" style="display: none;">
                <p><strong>Choisissez votre langue :</strong></p>
                <button onclick="goToLanguage('fr-FR')">üá´üá∑ Fran√ßais</button>
                <button onclick="goToLanguage('en-GB')">üá¨üáß English</button>
                <button onclick="goToLanguage('zh-CN')">üá®üá≥ ‰∏≠Êñá</button>
                <br><br>
                <p><strong>Ou acc√©dez directement :</strong></p>
                <button onclick="window.location.href='cv_fr.html'">üìÑ CV Fran√ßais</button>
                <button onclick="window.location.href='cv_en.html'">üìÑ CV English</button>
                <button onclick="window.location.href='cv_zh.html'">üìÑ CV ‰∏≠Êñá</button>
                <br><br>
                <button onclick="location.reload()" style="background: #e74c3c;">üîÑ Recharger</button>
            </div>
        </div>

        <!-- Panel de debug -->
        <div class="debug-info" id="debug-info">
            <div id="debug-content"></div>
        </div>

        <script>
            // Variables globales
            let debugMode = new URLSearchParams(window.location.search).has('debug');
            let timeoutId;
            
            // Afficher le debug si demand√©
            if (debugMode) {
                document.getElementById('debug-info').style.display = 'block';
                updateDebugInfo();
            }
            
            // Fonction pour aller vers une langue sp√©cifique
            function goToLanguage(lang) {
                console.log('üîó Redirection vers langue:', lang);
                
                // Sauvegarder la pr√©f√©rence
                localStorage.setItem('cv_langue', lang);
                
                // Fichiers statiques correspondants
                const fichiers = {
                    'fr-FR': 'cv_fr.html',
                    'en-GB': 'cv_en.html',
                    'zh-CN': 'cv_zh.html'
                };
                
                const fichier = fichiers[lang];
                if (fichier) {
                    window.location.href = fichier;
                } else {
                    // Fallback vers le contr√¥leur avec param√®tre
                    const url = new URL(window.location);
                    url.searchParams.set('lang', lang);
                    window.location.href = url.toString();
                }
            }
            
            // Fonction pour d√©terminer la langue automatiquement
            function determinerLangueAuto() {
                // 1. Param√®tre GET
                const urlParams = new URLSearchParams(window.location.search);
                const langueGet = urlParams.get('lang');
                if (langueGet && ['fr-FR', 'en-GB', 'zh-CN'].includes(langueGet)) {
                    return langueGet;
                }
                
                // 2. localStorage
                const langueSauvee = localStorage.getItem('cv_langue');
                if (langueSauvee && ['fr-FR', 'en-GB', 'zh-CN'].includes(langueSauvee)) {
                    return langueSauvee;
                }
                
                // 3. Navigateur
                const languesNav = navigator.languages || [navigator.language];
                for (const langue of languesNav) {
                    if (langue.startsWith('fr')) return 'fr-FR';
                    if (langue.startsWith('en')) return 'en-GB';
                    if (langue.startsWith('zh')) return 'zh-CN';
                }
                
                // 4. D√©faut
                return 'fr-FR';
            }
            
            // Fonction pour mettre √† jour les infos de debug
            function updateDebugInfo() {
                if (!debugMode) return;
                
                const debugContent = document.getElementById('debug-content');
                const info = {
                    'URL': window.location.href,
                    'Param√®tre lang': new URLSearchParams(window.location.search).get('lang') || 'aucun',
                    'localStorage': localStorage.getItem('cv_langue') || 'vide',
                    'Navigator': navigator.language,
                    'Accept-Language': navigator.languages.join(', '),
                    'User-Agent': navigator.userAgent.substring(0, 50) + '...'
                };
                
                debugContent.innerHTML = '<strong>üêõ Debug:</strong><br>' + 
                    Object.entries(info)
                        .map(([key, value]) => `<strong>${key}:</strong> ${value}`)
                        .join('<br>');
            }
            
            // Redirection automatique vers la langue appropri√©e
            document.addEventListener('DOMContentLoaded', () => {
                const langueChoisie = determinerLangueAuto();
                console.log('üåê Langue d√©termin√©e:', langueChoisie);
                
                // Sauvegarder le choix
                localStorage.setItem('cv_langue', langueChoisie);
                
                // Redirection avec un court d√©lai pour voir le chargement
                setTimeout(() => {
                    goToLanguage(langueChoisie);
                }, 1000);
            });
            
            // Timeout de s√©curit√© - afficher les boutons de secours apr√®s 5 secondes
            timeoutId = setTimeout(() => {
                const loading = document.querySelector('.loading h1');
                const emergency = document.getElementById('emergency-selector');
                
                if (loading && loading.textContent.includes('Chargement')) {
                    console.warn('‚ö†Ô∏è Timeout de chargement - affichage des boutons de secours');
                    loading.textContent = 'Probl√®me de chargement d√©tect√©';
                    emergency.style.display = 'block';
                }
            }, 5000);
            
            // Mettre √† jour le debug si activ√©
            if (debugMode) {
                setInterval(updateDebugInfo, 2000);
            }
            
            // Fonction pour forcer une langue (compatibilit√©)
            function forceLanguage(lang) {
                goToLanguage(lang);
            }
        </script>
    </body>
</html>