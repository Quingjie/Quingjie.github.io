<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CV Multilingue - Katell GOUZERH</title>
    
    <!-- CSS centralis√© -->
    <link rel="stylesheet" href="cv.css">
    
    <!-- Liens vers autres versions linguistiques pour le SEO -->
    <link rel="alternate" hreflang="fr-FR" href="?lang=fr-FR">
    <link rel="alternate" hreflang="en-GB" href="?lang=en-GB">
    <link rel="alternate" hreflang="zh-CN" href="?lang=zh-CN">
    <link rel="alternate" hreflang="x-default" href="/">
</head>
<body>
    <div class="loading">
        <h1>Chargement du CV multilingue...</h1>
        <p>Chargement du contenu dans la langue appropri√©e...</p>
    </div>

    <script>
        // Fonction pour d√©terminer la langue selon l'URL
        function determinerLangue() {
            const urlParams = new URLSearchParams(window.location.search);
            const langParam = urlParams.get('lang');
            
            // Si zh-CN ou en-GB est sp√©cifiquement demand√© dans l'URL
            if (langParam === 'zh-CN') {
                return 'zh-CN';
            } else if (langParam === 'en-GB') {
                return 'en-GB';
            }
            
            // Par d√©faut : fran√ßais
            return 'fr-FR';
        }
        
        // Fonction pour charger et afficher le contenu HTML appropri√©
        async function chargerContenu(langue) {
            const fichiers = {
                'fr-FR': 'cv_fr.html',
                'en-GB': 'cv_en.html',
                'zh-CN': 'cv_zh.html'
            };
            
            const fichier = fichiers[langue];
            
            try {
                console.log('üìÑ Chargement du fichier:', fichier);
                
                const response = await fetch(fichier);
                if (!response.ok) {
                    throw new Error(`Fichier ${fichier} non trouv√© (${response.status})`);
                }
                
                const htmlContent = await response.text();
                
                // Extraire seulement le contenu du body pour √©viter les conflits
                const parser = new DOMParser();
                const doc = parser.parseFromString(htmlContent, 'text/html');
                const bodyContent = doc.body.innerHTML;
                
                // Remplacer le contenu du body actuel
                document.body.innerHTML = bodyContent;
                
                // R√©attacher les √©v√©nements des boutons de langue
                attacherEvenementsLangue();
                
                console.log('‚úÖ Contenu charg√© avec succ√®s:', fichier);
                
            } catch (error) {
                console.error('‚ùå Erreur chargement:', error);
                afficherErreur(langue, fichier, error.message);
            }
        }
        
        // Fonction pour attacher les √©v√©nements aux boutons de langue
        function attacherEvenementsLangue() {
            const boutons = document.querySelectorAll('.lang-button');
            boutons.forEach(bouton => {
                bouton.addEventListener('click', async (e) => {
                    e.preventDefault();
                    
                    const href = bouton.getAttribute('href');
                    let nouvelleLangue = '';
                    
                    if (href.includes('cv_fr.html')) {
                        nouvelleLangue = 'fr-FR';
                    } else if (href.includes('cv_en.html')) {
                        nouvelleLangue = 'en-GB';
                    } else if (href.includes('cv_zh.html')) {
                        nouvelleLangue = 'zh-CN';
                    }
                    
                    if (nouvelleLangue) {
                        // Mettre √† jour l'URL sans recharger la page
                        const newUrl = new URL(window.location);
                        newUrl.searchParams.set('lang', nouvelleLangue);
                        window.history.pushState({}, '', newUrl);
                        
                        // Charger le nouveau contenu
                        await chargerContenu(nouvelleLangue);
                    }
                });
            });
        }
        
        // Fonction pour afficher une erreur si le fichier n'existe pas
        function afficherErreur(langue, fichier, erreur) {
            const langNames = {
                'fr-FR': 'Fran√ßais',
                'en-GB': 'English',
                'zh-CN': '‰∏≠Êñá'
            };
            
            document.body.innerHTML = `
                <div style="padding: 40px; text-align: center; font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto;">
                    <h1 style="color: #e74c3c;">‚ùå Erreur de chargement</h1>
                    <p>Impossible de charger le CV en <strong>${langNames[langue]}</strong>.</p>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 5px; margin: 20px 0; border-left: 4px solid #e74c3c;">
                        <strong>Fichier recherch√© :</strong> <code>${fichier}</code><br>
                        <strong>Erreur :</strong> ${erreur}
                    </div>
                    
                    <div style="background: #fff3cd; padding: 15px; border-radius: 5px; margin: 20px 0; border-left: 4px solid #ffc107;">
                        <h3 style="color: #856404; margin-top: 0;">Solutions :</h3>
                        <ul style="text-align: left; color: #856404;">
                            <li>V√©rifiez que le fichier <code>${fichier}</code> existe sur GitHub</li>
                            <li>Assurez-vous que le fichier utilise <code>&lt;link rel="stylesheet" href="cv.css"&gt;</code></li>
                            <li>V√©rifiez que tous les fichiers sont bien commit√©s et push√©s</li>
                        </ul>
                        
                        <div style="margin: 20px 0;">
                            <strong>Essayez ces liens directs :</strong><br>
                            <a href="cv_fr.html" style="display: inline-block; margin: 10px; padding: 12px 20px; background: #e74c3c; color: white; text-decoration: none; border-radius: 5px;">üá´üá∑ CV Fran√ßais</a>
                            <a href="cv_en.html" style="display: inline-block; margin: 10px; padding: 12px 20px; background: #27ae60; color: white; text-decoration: none; border-radius: 5px;">üá¨üáß CV English</a>
                            <a href="cv_zh.html" style="display: inline-block; margin: 10px; padding: 12px 20px; background: #f39c12; color: white; text-decoration: none; border-radius: 5px;">üá®üá≥ CV ‰∏≠Êñá</a>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button onclick="location.reload()" style="padding: 12px 24px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">üîÑ Recharger</button>
                    </div>
                    
                    <div style="margin-top: 20px; font-size: 12px; color: #6c757d;">
                        <strong>URL actuelle :</strong> ${window.location.href}<br>
                        <strong>Langue d√©tect√©e :</strong> ${langue}<br>
                        <strong>Fichiers requis :</strong> cv_fr.html, cv_en.html, cv_zh.html, cv.css
                    </div>
                </div>
            `;
        }
        
        // Gestion du bouton retour/avant du navigateur
        window.addEventListener('popstate', async () => {
            const langue = determinerLangue();
            await chargerContenu(langue);
        });
        
        // D√©marrage au chargement de la page
        document.addEventListener('DOMContentLoaded', async () => {
            const langueChoisie = determinerLangue();
            
            console.log('üåê Langue d√©termin√©e:', langueChoisie);
            console.log('üîó URL actuelle:', window.location.href);
            console.log('üìù Param√®tres URL:', new URLSearchParams(window.location.search).toString());
            
            // Charger le contenu appropri√©
            await chargerContenu(langueChoisie);
        });
    </script>
</body>
</html>